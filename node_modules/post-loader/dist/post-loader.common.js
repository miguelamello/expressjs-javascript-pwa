'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var matter = _interopDefault(require('gray-matter'));
var loaderUtils = _interopDefault(require('loader-utils'));

function postLoader(source) {
  this.cacheable && this.cacheable();

  var ref = matter(source);
  var data = ref.data;
  var content = ref.content;
  const stat = this.fs.statSync(this.resourcePath);

  const options = loaderUtils.getOptions(this) || {};

  const post = {
    data: Object.assign({}, {date: stat.birthtime},
      data),
    content,
    html: options.render ? options.render(content) : null
  };

  return `module.exports = ${JSON.stringify(post)}`
}

module.exports = postLoader;
